(function(t){function e(e){for(var r,n,l=e[0],o=e[1],c=e[2],h=0,f=[];h<l.length;h++)n=l[h],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&f.push(s[n][0]),s[n]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r]);u&&u(e);while(f.length)f.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],r=!0,l=1;l<a.length;l++){var o=a[l];0!==s[o]&&(r=!1)}r&&(i.splice(e--,1),t=n(n.s=a[0]))}return t}var r={},s={app:0},i=[];function n(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=r,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],o=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=o;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("f751"),a("097d");var r=a("2b0e"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},i=[],n={name:"app"},l=n,o=a("2877"),c=Object(o["a"])(l,s,i,!1,null,null,null),u=c.exports,h=a("5f5b"),f=a("bc3a"),m=a.n(f),d=a("a7fe"),g=a.n(d),b=a("8c4f"),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"bg-light"},[a("b-navbar",{attrs:{toggleable:"lg",type:"dark",variant:"info"}},[a("b-navbar-brand",{attrs:{href:"http://iiif.nakamurasatoru.com/comp"}},[t._v("IIIF Curation Comparison")]),a("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),a("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[a("b-navbar-nav",{staticClass:"ml-auto"},[a("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.modal-1",modifiers:{"modal-1":!0}}],staticClass:"m-1"},[a("i",{staticClass:"fas fa-search"}),t._v(" Advanced Search\n        ")]),a("b-button",{staticClass:"m-1",on:{click:function(e){t.sidebar_open_flg=!t.sidebar_open_flg}}},[t.sidebar_open_flg?[t._v("Hide Sidebar")]:[t._v("Show Sidebar")]],2)],1)],1)],1),a("b-container",{attrs:{fluid:""}},[a("b-row",{staticClass:"my-5"},[a("b-col",{directives:[{name:"show",rawName:"v-show",value:t.sidebar_open_flg,expression:"sidebar_open_flg"}],attrs:{sm:3}},t._l(t.data.aggregations,(function(e,r){return a("b-card",{directives:[{name:"show",rawName:"v-show",value:e.buckets.length>0,expression:"agg.buckets.length > 0"}],key:r,staticClass:"mb-4",attrs:{header:r}},[a("b-button",{staticClass:"mb-3",attrs:{type:"button",size:"sm",variant:"outline-secondary"},on:{click:t.search}},[a("i",{staticClass:"fas fa-search"}),t._v(" Search\n          ")]),a("b-form-group",t._l(t.query.aggs[r].flg?e.buckets:e.buckets.slice(0,t.facet_show_size),(function(e,s){return a("b-form-checkbox",{key:s,attrs:{value:e.key,name:"flavour-3a"},model:{value:t.query.aggs[r].value,callback:function(e){t.$set(t.query.aggs[r],"value",e)},expression:"query.aggs[label].value"}},[t._v("\n              "+t._s(e.key)+"\n              "),a("b-badge",[t._v(t._s(e.doc_count.toLocaleString()))])],1)})),1),a("div",{staticClass:"text-right"},[e.buckets.length>t.facet_show_size?a("b-button",{attrs:{type:"button",variant:"link",size:"sm"},on:{click:function(e){t.query.aggs[r].flg=!t.query.aggs[r].flg}}},[t.query.aggs[r].flg?[t._v("Show less")]:[t._v("Show more "+t._s(e.buckets.length-t.facet_show_size)+" items")]],2):t._e()],1)],1)})),1),a("b-col",{attrs:{sm:t.sidebar_open_flg?9:12}},[a("b-row",{staticClass:"mb-4"},[a("b-col",{staticClass:"mb-2",attrs:{sm:"12"}},[t._v(t._s(t.total>0?((t.currentPage-1)*t.perPage+1).toLocaleString():0)+" - "+t._s(t.currentPage*t.perPage>t.total?t.total.toLocaleString():(t.currentPage*t.perPage).toLocaleString())+" of "+t._s(t.total.toLocaleString())+" results")]),a("b-col",{attrs:{sm:"12"}},[a("b-form",{attrs:{inline:""}},[a("label",{staticClass:"mr-sm-2",attrs:{for:"inline-form-custom-select-pref"}},[t._v("Per page:")]),a("b-form-select",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{options:{20:"20",50:"50",100:"100",1e3:"1000"},id:"inline-form-custom-select-pref"},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}}),a("label",{staticClass:"mr-sm-2",attrs:{for:"inline-form-custom-select-pref"}},[t._v("Sort by:")]),a("b-form-select",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{options:t.sort_options,id:"inline-form-custom-select-pref"},model:{value:t.sort,callback:function(e){t.sort=e},expression:"sort"}}),a("div",{staticClass:"input-group mb-2 mr-sm-2 mb-sm-0"},[a("div",{staticClass:"btn-group-toggle btn-group"},t._l(t.d_options,(function(e,r){return a("label",{key:r,staticClass:"btn btn-outline-primary",class:[e.value==t.grid?"active":""]},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.grid,expression:"grid"}],attrs:{type:"radio",autocomplete:"off"},domProps:{value:e.value,checked:t._q(t.grid,e.value)},on:{change:function(a){t.grid=e.value}}}),a("span",{domProps:{innerHTML:t._s(e.text)}})])})),0)]),a("label",{directives:[{name:"show",rawName:"v-show",value:"grid"==t.grid,expression:"grid == 'grid'"}],staticClass:"mr-sm-2",attrs:{for:"inline-form-custom-select-pref"}},[t._v("Per row:")]),a("b-form-select",{directives:[{name:"show",rawName:"v-show",value:"grid"==t.grid,expression:"grid == 'grid'"}],staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{options:{12:"12",6:"6",4:"4"},id:"inline-form-custom-select-pref"},model:{value:t.col,callback:function(e){t.col=e},expression:"col"}})],1)],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"table"!=t.grid,expression:"grid != 'table'"}],staticClass:"text-right mb-4"},[a("b-button",{staticClass:"my-2 mr-2",on:{click:t.select_all}},[a("i",{staticClass:"fas fa-check-square"}),t._v(" Select All")]),a("b-button",{staticClass:"my-2 mr-2",on:{click:t.deselect_all}},[a("i",{staticClass:"fas fa-square"}),t._v(" Unselect All")]),a("b-button",{staticClass:"my-2 mr-2",attrs:{variant:"info"},on:{click:t.compare}},[t._v("Compare "),a("i",{staticClass:"fas fa-external-link-alt"})])],1),t.total>0?a("b-pagination",{staticClass:"mb-4",attrs:{"total-rows":t.total,"per-page":t.perPage,"aria-controls":"my-table",align:"center"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e(),a("b-row",{directives:[{name:"show",rawName:"v-show",value:"grid"==t.grid,expression:"grid == 'grid'"}]},t._l(t.hits,(function(e,r){return a("b-col",{key:r,attrs:{sm:12/t.col}},[a("b-card",{staticClass:"mb-4",attrs:{"no-body":""}},[a("b-link",{staticStyle:{"background-color":"black"},attrs:{href:e._url,target:"_blank"}},[e._thumbnail?a("b-img-lazy",{staticStyle:{display:"flex",margin:"auto","max-height":"150px","max-width":"100%"},attrs:{src:e._thumbnail,alt:"Image 1"}}):t._e()],1),a("b-card-body",[a("b-link",{attrs:{href:e._url,target:"_blank"}},[a("b",[t._v(t._s(e._label))])]),a("b-form-checkbox",{attrs:{name:"check-button",switch:""},model:{value:e._checked,callback:function(a){t.$set(e,"_checked",a)},expression:"value._checked"}})],1)],1)],1)})),1),t._l(t.hits,(function(e,r){return a("b-card",{directives:[{name:"show",rawName:"v-show",value:"list"==t.grid,expression:"grid == 'list'"}],key:r,staticClass:"mb-4",attrs:{"no-body":""}},[a("b-card-body",[a("b-row",[a("b-col",{attrs:{sm:"3"}},[a("b-link",{attrs:{href:e._url,target:"_blank"}},[e._thumbnail?a("b-img-lazy",{staticClass:"pb-2",staticStyle:{"max-height":"150px","max-width":"100%"},attrs:{src:e._thumbnail,alt:"Image 1",center:""}}):t._e()],1)],1),a("b-col",{attrs:{sm:"9"}},[a("b-link",{attrs:{href:e._url,target:"_blank"}},[a("b",[t._v(t._s(e._label))])]),a("b-card-text",[t._v(t._s(e.metadata))]),a("b-form-checkbox",{attrs:{name:"check-button",switch:""},model:{value:e._checked,callback:function(a){t.$set(e,"_checked",a)},expression:"value._checked"}})],1)],1)],1)],1)})),a("b-table",{directives:[{name:"show",rawName:"v-show",value:"table"==t.grid,expression:"grid == 'table'"}],staticClass:"mb-4",attrs:{striped:"",hover:"",fields:t.fields,items:t.items_table,responsive:""},scopedSlots:t._u([{key:"cell(_label)",fn:function(e){return[a("b-link",{attrs:{href:e.item._url,target:"_blank"}},[a("b",[t._v(t._s(e.item._label))])])]}},{key:"cell()",fn:function(e){return[t._v(t._s(e.value))]}}])}),t.total>0?a("b-pagination",{staticClass:"mb-4",attrs:{"total-rows":t.total,"per-page":t.perPage,"aria-controls":"my-table",align:"center"},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}}):t._e()],2)],1)],1),t._m(0),a("b-modal",{attrs:{id:"modal-1",size:"lg",title:"Advanced Search","hide-footer":""}},[t._l(t.forms,(function(e,r){return a("b-row",{key:r,staticClass:"my-2"},[a("b-col",{attrs:{sm:"4"}},[a("b-form-select",{attrs:{options:t.advanced_search_options},model:{value:e.label,callback:function(a){t.$set(e,"label",a)},expression:"form.label"}})],1),a("b-col",{attrs:{sm:"8"}},[a("b-form-input",{staticClass:"mb-2 mr-sm-2 mb-sm-0",model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"form.value"}})],1)],1)})),a("b-button",{staticClass:"my-2",on:{click:t.add_form}},[a("i",{staticClass:"fas fa-plus"}),t._v(" Add\n    ")]),a("br"),a("b-button",{staticClass:"my-2",attrs:{variant:"primary"},on:{click:t.search}},[a("i",{staticClass:"fas fa-search"}),t._v(" Search\n    ")])],2)],1)},v=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("footer",{staticClass:"bd-footer text-muted"},[a("div",{staticClass:"container"},[a("hr"),a("p",{staticClass:"mt-4 pb-5 text-center"},[a("a",{attrs:{href:"https://researchmap.jp/nakamura.satoru/?lang=english"}},[t._v("Satoru Nakamura")])])])])}],_=(a("a481"),a("456d"),a("ac6a"),a("ffc1"),a("28a5"),a("386d"),a("96cf"),a("3b8d")),y=(a("55dd"),a("c5f6"),{name:"HelloWorld",data:function(){return{data:[],currentPage:1,perPage:20,grid:"grid",col:4,sort:"_score_desc",total:0,hits:[],query:{aggs:{},q:""},facet_show_size:10,search_flg:!1,hits_all:[],forms:[{}],advanced_search_options:[],d_options:[{text:"<i class='fas fa-th-large'></i>",value:"grid"},{text:"<i class='fas fa-th-list'></i>",value:"list"},{text:"<i class='fas fa-table'></i>",value:"table"}],df_map:{},sort_options:[{value:"_score_desc",text:"Relevance"}],mani_arr:{},curation:null,fields:[{name:"Label",key:"_label"}],items_table:[],sidebar_open_flg:!0}},mounted:function(){var t=this.$route.query,e=t.query?JSON.parse(t.query):{};this.currentPage=t.currentPage?Number(t.currentPage):this.currentPage,this.perPage=t.perPage?Number(t.perPage):this.perPage,this.col=t.col?Number(t.col):this.col,this.grid=t.grid?t.grid:this.grid,this.sort=t.sort?t.sort:this.sort,this.curation=t.curation,null==this.curation&&(location.href="http://iiif.nakamurasatoru.com/comp"),this.init_curation(this.curation,e)},methods:{init_curation:function(){var t=Object(_["a"])(regeneratorRuntime.mark((function t(e,a){var r,s,i,n,l,o,c,u,h,f,d,g,b,p,v,_,y,k,w,x,P,C,q,S;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,m.a.get(e);case 2:for(r=t.sent,s=[],i=r.data.selections,n=1,l=[],o={},c=0;c<i.length;c++)for(u=i[c],h=u.members,f=0;f<h.length;f++){if(d=h[f],g={_label:d.label,_url:"http://codh.rois.ac.jp/software/iiif-curation-viewer/demo/?curation="+e+"&pos="+n,_checked:!1,_id:d["@id"],_manifest:u.within["@id"],metadata:{}},n+=1,d["metadata"])for(b=d["metadata"],p=0;p<b.length;p++)v=b[p],_=v.label,y=v.value,g.metadata[_]=y,-1==l.indexOf(_)&&l.push(_),o[_]||(o[_]={}),k=o[_],k[y]||(k[y]=[]),k[y].push(s.length);d["thumbnail"]?g["_thumbnail"]=d["thumbnail"]:g["_thumbnail"]=this.get_thumbnails(g),s.push(g)}for(this.hits_all=s,w=0;w<l.length;w++)x=l[w],this.advanced_search_options.push({value:x,text:x}),this.fields.push(x),this.sort_options.push({value:x+"_asc",text:x+" Asc"}),this.sort_options.push({value:x+"_desc",text:x+" Desc"});for(C in P={},o)for(S in q=o[C],P[C]=[],q)P[C].push({key:S,value:q[S]});this.df_map=P,this.init(a);case 15:case"end":return t.stop()}}),t,this)})));function e(e,a){return t.apply(this,arguments)}return e}(),init:function(t){for(var e=[],a=0;a<this.advanced_search_options.length;a++)e.push({label:this.advanced_search_options[a].text,field:this.advanced_search_options[a].text});t.q&&(this.query.q=t.q);for(var r={},s=0;s<e.length;s++){var i=e[s].label,n={field:e[s].field,flg:!1},l=[];t.aggs&&t.aggs[i]&&(l=t.aggs[i]),n.value=l,r[i]=n}this.query.aggs=r,this.search(),this.search_flg=!0},search:function(){this.update_param();var t={query:{bool:{must:[],filter:[]}},aggs:{},size:this.perPage,from:this.currentPage-1};for(var e in this.query.aggs){var a=this.query.aggs[e];t.aggs[e]={terms:{field:a.field,size:50,order:{_count:"desc"}}}}if(""!=this.query.q)for(var r=this.query.q,s=r.split("ã€€").join(" ").split(" "),i=0;i<s.length;i++){var n=s[i];t.query.bool.must.push({match_phrase:{label:n}})}var l=this.query.aggs;for(var o in l){var c=l[o]["value"];if(c.length>0){var u=[];t.query.bool.filter.push({bool:{should:u}});for(var h=0;h<c.length;h++){var f={};f[l[o].field]=c[h],u.push({term:f})}}}this.es(t)},es:function(t){for(var e=t.query.bool.filter,a={},r=0;r<e.length;r++)for(var s=e[r],i=s.bool.should,n=0;n<i.length;n++){var l=i[n].term,o=Object.entries(l)[0],c=o[0],u=o[1];a[c]||(a[c]=[]),a[c].push(u)}for(var h=0;h<this.forms.length;h++){var f=this.forms[h],m=f.label,d=f.value;""!=d&&null!=d&&(a[m]=[d])}for(var g=this.get_sorted_ids(),b=[],p={},v=0;v<g.length;v++){var _=g[v],y=this.hits_all[_],k=y.metadata,w=!0;for(var x in a){var P=a[x];if(k[x]){if(P.length>0){for(var C=!1,q=0;q<P.length;q++)-1!=k[x].indexOf(P[q])&&(C=!0);C||(w=!1)}}else w=!1}if(w)for(var S in b.push(y),k){var j=k[S];p[S]||(p[S]={});var O=p[S];O[j]||(O[j]=0),O[j]+=1}}this.data=b;var N={},z=function(t){var e=[],a=p[t],r=Object.keys(a).map((function(t){return{key:t,value:a[t]}}));r.sort((function(t,e){return t.value<e.value?1:t.value>e.value?-1:0}));for(var s=0;s<r.length;s++){var i=r[s],n={key:i.key,doc_count:i.value};e.push(n)}N[t]={buckets:e}};for(var $ in p)z($);var L=b.length;this.total=L;for(var A=this.perPage,I=this.currentPage,M=[],J=(I-1)*A,R=I*A>L?L:I*A,T=[],E=J;E<R;E++){var H=b[E];M.push(H);var U={};for(var D in U._url=H._url,U._label=H._label,H.metadata)U[D]=H.metadata[D];T.push(U)}this.items_table=T;var F={hits:M,total:{relation:"gte",value:b.length}},W={aggregations:N,hits:F};this.data=W,this.hits=F.hits},update_param:function(){var t=this.query,e={q:t.q,aggs:{}};for(var a in t.aggs)t.aggs[a].value.length>0&&(e.aggs[a]=t.aggs[a].value);var r={curation:this.curation,query:JSON.stringify(e),currentPage:this.currentPage,perPage:this.perPage,col:this.col,grid:this.grid,sort:this.sort};this.$router.replace({name:"home",query:r},(function(){}),(function(){}))},add_form:function(){this.forms.push({value:""})},compare:function(){for(var t=[],e=0;e<this.hits.length;e++){var a=this.hits[e];a._checked&&t.push(a._manifest+"#"+a._id)}var r="https://nakamura196.github.io/i3/comp/compare.html?param="+encodeURIComponent(t.join(";"));window.open(r,"compare")},select_all:function(){for(var t=0;t<this.hits.length;t++){var e=this.hits[t];e._checked=!0}},deselect_all:function(){for(var t=0;t<this.hits.length;t++){var e=this.hits[t];e._checked=!1}},get_thumbnails:function(t){var e=this,a=t._manifest;if(this.mani_arr[a])return t._thumbnail=this.get_thumbnail(t),t._thumbnail;m.a.get(a).then((function(r){var s=r.data,i={};e.mani_arr[a]=i;for(var n=s["sequences"][0]["canvases"],l=0;l<n.length;l++){var o=n[l];o["images"][0]["resource"]["service"]?i[o["@id"]]=o["images"][0]["resource"]["service"]["@id"]+"/info.json":i[o["@id"]]=o["images"][0]["resource"]["@id"]}return t._thumbnail=e.get_thumbnail(t),t._thumbnail}))},get_thumbnail:function(t){var e=t._id.split("#xywh="),a=e[0],r=e[1],s=this.mani_arr[t._manifest][a];return-1!=s.indexOf("info.json")&&(s=s.replace("info.json",r+"/200,/0/default.jpg")),s},get_sorted_ids:function(){var t=this.sort.split("_"),e=t[0],a=t[1],r=this.df_map[e],s=[];if(null!=r){"asc"==a?r.sort((function(t,e){return e.key<t.key?1:e.key>t.key?-1:0})):r.sort((function(t,e){return e.key>t.key?1:e.key<t.key?-1:0}));for(var i=0;i<r.length;i++)for(var n=r[i].value,l=0;l<n.length;l++){var o=n[l];-1==s.indexOf(o)&&s.push(o)}}else for(var c=0;c<this.hits_all.length;c++)s.push(c);return s}},watch:{currentPage:function(){this.search_flg&&this.search(),this.update_param()},perPage:function(){this.search_flg&&this.search(),this.update_param()},sort:function(){this.search_flg&&this.search(),this.update_param()},col:function(){this.update_param()},grid:function(){this.update_param()}}}),k=y,w=Object(o["a"])(k,p,v,!1,null,null,null),x=w.exports;r["default"].use(b["a"]);var P=new b["a"]({routes:[{path:"/",name:"home",component:x}]});a("f9e3"),a("2dd8");r["default"].use(h["a"],m.a,g.a),r["default"].config.productionTip=!1,new r["default"]({router:P,render:function(t){return t(u)}}).$mount("#app")}});
//# sourceMappingURL=app.22f232ba.js.map