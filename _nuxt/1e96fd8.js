(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{430:function(t,e,n){"use strict";n.r(e);n(270),n(271),n(32),n(45),n(85),n(155),n(59),n(18),n(23),n(37),n(50),n(38),n(68),n(46);var r=n(10),o=n(13),c=n(21),l=n(24),f=n(22),h=n(11),v=n(6),m=n(66),d=n(117),y=n.n(d);function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(h.a)(t);if(e){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(f.a)(this,n)}}var k=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(v.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},x=function(t){Object(l.a)(m,t);var e,n,f,h,v=_(m);function m(){var t;return Object(o.a)(this,m),(t=v.apply(this,arguments)).baseUrl="https://nakamura196.github.io/i3",t.uriDownloaded=!1,t.collectionUriGenerating=!1,t.result=!1,t.curationUri="",t.manifestProgress="",t.annoProgress="",t.uri="",t.generating=!1,t.collection={},t.collectionUri="",t.viewers=[{url:"http://mirador.cultural.jp/?manifest=",icon:t.baseUrl+"/img/icons/mirador3.svg",label:"Miradorで閲覧する"},{url:"http://www.kanzaki.com/works/2016/pub/image-annotator?u=",icon:t.baseUrl+"/img/icons/ia.png",label:"Image Annotatorで閲覧する"},{url:"http://universalviewer.io/examples/uv/uv.html#?manifest=",icon:t.baseUrl+"/img/icons/uv.jpg",label:"Universal Viewerで閲覧する"},{url:"https://nakamura196.github.io/icc2/?u=",icon:t.baseUrl+"/img/icons/sn.png",label:"IIIF Multi Viewerで閲覧する"},{url:"https://nakamura196.github.io/portal_pro/common/javala/?collection=",icon:t.baseUrl+"/img/icons/javala.jpg",label:"Javalaで閲覧する"},{url:"https://self-museum.cultural.jp/?collection=",icon:t.baseUrl+"/img/icons/favicon.ico",label:"セルフミュージアムで閲覧する"},{url:"http://pocket.cultural.jp/?url=",icon:t.baseUrl+"/img/icons/cj.png",label:"IIIF Pocketで閲覧する"},{url:t.baseUrl+"/collection/?u=",icon:t.baseUrl+"/img/icons/sn.png",label:"Infinite Loading for IIIF Collectionで閲覧する"}],t}return Object(c.a)(m,[{key:"head",value:function(){return{titleTemplate:null,title:this.$t("IIIF Converter")}}},{key:"mounted",value:(h=Object(r.a)(regeneratorRuntime.mark((function t(){var e,n,r,o,c,l,i,f,h,v,m,d,y,_,k,x,w,I,j,C,O,R,U,$,P,V,D,M,T,F,B,G,L,A,H,K;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.$route.query.u){t.next=3;break}return t.abrupt("return");case 3:return n=e+"",this.uri=n,this.uriDownloaded=!0,t.next=8,this.getData(n);case 8:if(r=t.sent){t.next=12;break}return this.uriDownloaded=!1,t.abrupt("return");case 12:for(o={},c={},l=r.selections,i=0;i<l.length;i++)for(f=l[i],h=f.within["@id"],o[h]||(o[h]=[]),v=f.members,m=0;m<v.length;m++)d=v[m],y=d["@id"],_=y.split("#"),k=_[0],(x=o[h]).includes(k)||x.push(k),w=_[1],c[k]||(c[k]=[]),c[k].push({label:d.label,description:d.description,metadata:d.metadata,xywh:w});return this.collectionUriGenerating=!0,t.next=19,this.create({});case 19:if(t.t0=t.sent,t.t0){t.next=22;break}t.t0="";case 22:I=t.t0,j=[],C={"@context":"http://iiif.io/api/presentation/2/context.json",label:r.label,"@type":"sc:Collection",vhint:"use-thumb",viewingHint:"grid","@id":I,manifests:j},O=Object.keys(o).length,R=1,t.t1=regeneratorRuntime.keys(o);case 28:if((t.t2=t.t1()).done){t.next=74;break}return U=t.t2.value,this.manifestProgress="3/4 "+this.$t("Generating Manifest")+" "+R+"/"+O,R+=1,this.annoProgress="",t.next=35,this.getData(U);case 35:if(null!=($=t.sent)){t.next=38;break}return t.abrupt("continue",28);case 38:return t.next=40,this.create({});case 40:if(t.t3=t.sent,t.t3){t.next=43;break}t.t3="";case 43:P=t.t3,V=o[U],D=0;case 46:if(!(D<V.length)){t.next=66;break}return M=V[D],T=c[M],this.annoProgress=this.$t("Generating annotations")+" "+(D+1)+"/"+V.length,t.next=52,this.create({});case 52:if(t.t4=t.sent,t.t4){t.next=55;break}t.t4="";case 55:for(F=t.t4,G={"@context":"http://iiif.io/api/presentation/2/context.json","@id":F,"@type":"sc:AnnotationList",resources:B=[]},L=function(t){var e=T[t],text=JSON.stringify(e.metadata);null==text&&(text="Curation ["+(t+1)+"]");var n=e.xywh,r=F+"#"+t,o=[];e.label&&o.push({"@type":"dctypes:Text",chars:e.label,format:"text/html"}),e.description&&o.push({"@type":"dctypes:Text",chars:e.description,format:"text/html"});var c=e.metadata;c&&c.map((function(t){o.push({"@type":"oa:Tag",chars:t.label+": "+t.value})}));var l={"@id":r,"@type":"oa:Annotation",motivation:"sc:painting",resource:o,on:M+"#"+n};B.push(l)},A=0;A<T.length;A++)L(A);return t.next=62,this.update(F,G);case 62:$=this.setOtherContent($,M,F);case 63:D++,t.next=46;break;case 66:return $["@id"]=P,t.next=69,this.update(P,$);case 69:H={"@type":"sc:Manifest","@id":P,label:$.label,attribution:$.attribution},$.sequences[0].canvases[0].thumbnail&&(H.thumbnail=$.sequences[0].canvases[0].thumbnail["@id"]),j.push(H),t.next=28;break;case 74:return this.generating=!0,t.next=77,this.update(I,C);case 77:K=t.sent,this.collection=C,this.collectionUri=I,"error"===K||(this.result=!0);case 81:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"setOtherContent",value:function(t,e,n){for(var r=t.sequences[0].canvases,i=0;i<r.length;i++){var canvas=r[i];canvas["@id"]===e&&(canvas.otherContent=[{"@id":n,"@type":"sc:AnnotationList"}])}return t}},{key:"getData",value:(f=Object(r.a)(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.a.get(e).then((function(t){return t.data})).catch((function(){return null}));case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)}))),function(t){return f.apply(this,arguments)})},{key:"create",value:(n=Object(r.a)(regeneratorRuntime.mark((function t(data){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return data.a="b",e="https://api.jsonbin.io/v3/b",t.next=4,y.a.post(e,data,{headers:{"Content-Type":"application/json","X-Master-Key":"$2b$10$unmAqqNkGBsCaaOK3d4QEui0i./fZ0INKty90iDOBMHHRoB.ywT.S","X-Bin-Private":"false"}}).then((function(t){return e.replace("/v3","")+"/"+t.data.metadata.id+"/1"})).catch((function(){return""}));case 4:return n=t.sent,t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})},{key:"update",value:(e=Object(r.a)(regeneratorRuntime.mark((function t(e,data){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.a.put(e.slice(0,-2),JSON.stringify(data),{headers:{"Content-Type":"application/json","X-Master-Key":"$2b$10$unmAqqNkGBsCaaOK3d4QEui0i./fZ0INKty90iDOBMHHRoB.ywT.S","X-Bin-Private":"false"}}).then((function(){return"success"})).catch((function(){return"error"}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),function(t,n){return e.apply(this,arguments)})},{key:"submit1",value:function(){return"aaa"}},{key:"manifests",get:function(){var t=this.collection;if(!t.manifests)return[];var e=t.manifests,n=[{id:t["@id"],label:this.$t("IIIF Collection")}];return e.map((function(t){n.push({id:t["@id"],label:t.label,attribution:t.attribution})})),n}}]),m}(m.Vue),w=x=k([Object(m.Component)({layout:"conv",components:{}})],x),I=n(58),j=n(87),C=n.n(j),O=n(397),R=n(402),U=n(400),$=n(407),P=n(399),V=n(185),D=n(118),M=n(44),T=n(99),F=n(408),B=n(426),component=Object(I.a)(w,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-container",{staticClass:"my-10"},[n("h2",{staticClass:"mb-10"},[t._v(t._s(t.$t("Convert IIIF Curation to Manifest")))]),t._v(" "),n("v-card",{staticClass:"mb-10",attrs:{flat:"",outlined:""}},[n("div",{staticClass:"pa-5"},[n("v-text-field",{attrs:{label:t.$t("Curation URI"),required:""},model:{value:t.uri,callback:function(e){t.uri=e},expression:"uri"}}),t._v(" "),n("v-btn",{attrs:{color:"primary",href:t.localePath({name:"conv-convert2manifest",query:{u:t.uri}})}},[t._v(t._s(t.$t("Submit")))])],1)]),t._v(" "),t.result?t._e():n("div",[t.uriDownloaded?n("ul",[n("li",[t._v("1/4 "+t._s(t.$t("IIIF Curation Downloaded.")))]),t._v(" "),t.collectionUriGenerating?n("li",[t._v("\n          2/4 "+t._s(t.$t("Generating Collection URI."))+"\n        ")]):t._e(),t._v(" "),""!=t.manifestProgress?n("li",[t._v("\n          "+t._s(t.manifestProgress)+"\n          "),n("ul",[t.annoProgress?n("li",[t._v("\n              "+t._s(t.annoProgress)+"\n            ")]):t._e()])]):t._e(),t._v(" "),t.generating?n("li",[t._v("\n          4/4 "+t._s(t.$t("Generating IIIF Collection ..."))+"\n        ")]):t._e()]):t._e()]),t._v(" "),t.result?n("div",[n("v-row",[n("v-col",{attrs:{cols:"12",sm:"6"}},[n("v-card",[n("v-card-title",{staticClass:"headline grey lighten-2"},[t._v(t._s(t.$t("IIIF Manifest")))]),t._v(" "),n("v-list",t._l(t.manifests,(function(e,r){return n("v-list-item",{key:r,attrs:{href:e.id,target:"_blank"}},[n("v-list-item-icon",[n("img",{attrs:{src:t.baseUrl+"/img/icons/iiif-logo.svg",width:"30"}})]),t._v(" "),n("v-list-item-content",[t._v("\n                  "+t._s(e.label)+"\n                ")]),t._v(" "),n("v-list-item-content",[e.attribution?[n("span",{domProps:{innerHTML:t._s(e.attribution)}})]:t._e()],2)],1)})),1)],1)],1),t._v(" "),n("v-col",{attrs:{cols:"12",sm:"6"}},[n("v-card",[n("v-card-title",{staticClass:"headline grey lighten-2"},[t._v(t._s(t.$t("Viewer")))]),t._v(" "),n("v-list",t._l(t.viewers,(function(e,r){return n("v-list-item",{key:r,attrs:{href:e.url+t.collectionUri,target:"_blank"}},[n("v-list-item-icon",[n("img",{attrs:{src:e.icon,width:"30"}})]),t._v("\n                "+t._s(t.$t(e.label))+"\n              ")],1)})),1)],1)],1)],1)],1):t._e()],1)],1)}),[],!1,null,null,null);e.default=component.exports;C()(component,{VBtn:O.a,VCard:R.a,VCardTitle:U.b,VCol:$.a,VContainer:P.a,VList:V.a,VListItem:D.a,VListItemContent:M.a,VListItemIcon:T.a,VRow:F.a,VTextField:B.a})}}]);